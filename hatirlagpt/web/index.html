<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Giriş / Kayıt</title>
</head>
<body>
  <h2>Giriş Yap</h2>
  <form id="loginForm">
    <input type="email" id="loginEmail" placeholder="Email" required /><br />
    <input type="password" id="loginPassword" placeholder="Şifre" required /><br />
    <button type="submit">Giriş Yap</button>
  </form>

  <p>Hesabın yok mu? <a href="#" id="showRegister">Kayıt Ol</a></p>

  <div id="registerSection" style="display:none;">
    <h2>Kayıt Ol</h2>
    <form id="registerForm">
      <input type="text" id="registerUsername" placeholder="Kullanıcı Adı" required /><br />
      <input type="email" id="registerEmail" placeholder="Email" required /><br />
      <input type="password" id="registerPassword" placeholder="Şifre" required /><br />
      <button type="submit">Kayıt Ol</button>
    </form>
    <p>Zaten hesabın var mı? <a href="#" id="showLogin">Giriş Yap</a></p>
  </div>

  <div id="message"></div>

  <script>
    const loginForm = document.getElementById('loginForm')
    const registerForm = document.getElementById('registerForm')
    const registerSection = document.getElementById('registerSection')
    const showRegisterLink = document.getElementById('showRegister')
    const showLoginLink = document.getElementById('showLogin')
    const messageDiv = document.getElementById('message')

    showRegisterLink.addEventListener('click', e => {
      e.preventDefault()
      loginForm.style.display = 'none'
      registerSection.style.display = 'block'
      messageDiv.textContent = ''
    })

    showLoginLink.addEventListener('click', e => {
      e.preventDefault()
      registerSection.style.display = 'none'
      loginForm.style.display = 'block'
      messageDiv.textContent = ''
    })

    loginForm.addEventListener('submit', async e => {
      e.preventDefault()
      const email = document.getElementById('loginEmail').value.trim()
      const password = document.getElementById('loginPassword').value.trim()

      const res = await fetch('http://localhost:3000/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password }),
      })

      const data = await res.json()

      if (res.ok) {
        messageDiv.textContent = 'Hoşgeldin, ' + data.username
        // Burada giriş sonrası yapılacaklar (örn. ana sayfaya geçiş)
      } else {
        messageDiv.textContent = 'Hata: ' + (data.error || 'Bilinmeyen hata')
      }
    })

    registerForm.addEventListener('submit', async e => {
      e.preventDefault()
      const username = document.getElementById('registerUsername').value.trim()
      const email = document.getElementById('registerEmail').value.trim()
      const password = document.getElementById('registerPassword').value.trim()

      const res = await fetch('http://localhost:3000/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, email, password }),
      })

      const data = await res.json()

      if (res.ok) {
        messageDiv.textContent = 'Kayıt başarılı! Şimdi giriş yapabilirsiniz.'
        registerSection.style.display = 'none'
        loginForm.style.display = 'block'
      } else {
        messageDiv.textContent = 'Hata: ' + (data.error || 'Bilinmeyen hata')
      }
    })
  </script>
</body>
</html>
